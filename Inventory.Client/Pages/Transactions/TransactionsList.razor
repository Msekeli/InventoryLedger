@page "/transactions"
@inject IStockTransactionService TransactionService

<h3 class="mt-3">Transaction History</h3>

<div class="card p-3 shadow-sm mb-3">
    <div class="mb-3">
        <label class="form-label">Item ID</label>
        <input class="form-control" type="number" @bind="itemId" />
    </div>

    <button class="btn btn-primary" @onclick="LoadTransactions">Load</button>
</div>

@if (transactions == null)
{
    <p>Enter an Item ID and click Load.</p>
}
else if (transactions.Count == 0)
{
    <p>No transactions found for this item.</p>
}
else
{
    <div class="table-responsive shadow-sm">
        <table class="table table-striped align-middle">
            <thead class="table-light">
                <tr>
                    <th>Date</th>
                    <th>Type</th>
                    <th>Quantity</th>
                    <th>Reference</th>
                </tr>
            </thead>

            <tbody>
            @foreach (var tx in transactions)
            {
                <tr class="@(tx.QuantityChange > 0 ? "table-success" : "table-danger")">
                    <td>@tx.Timestamp.ToLocalTime().ToString("yyyy-MM-dd HH:mm")</td>
                    <td>@(tx.QuantityChange > 0 ? "IN" : "OUT")</td>
                    <td>@Math.Abs(tx.QuantityChange)</td>
                    <td>@tx.Reference</td>
                </tr>
            }
            </tbody>
        </table>
    </div>
}

@code {
    private int itemId;
    private List<StockTransactionDto>? transactions;

    private async Task LoadTransactions()
    {
        transactions = await TransactionService.GetByItemAsync(itemId);
    }
}
